<div class="card-container max-w-5xl mx-auto">
    <!-- Header Program -->
    <div class="mb-6 text-center">
        <span class="text-sm font-bold text-primary-teal bg-teal-50 px-3 py-1 rounded-full"><%= program.nama_pusat %></span>
        <h2 id="program-title-for-share" class="text-4xl font-bold mt-3"><%= program.title %></h2>
        <p class="text-md text-gray-500 mt-1">Dikoordinasi oleh: <%= program.coordinator_name %></p>
    </div>

    <!-- Notifikasi -->
    <% if (typeof success_msg !== 'undefined' && success_msg) { %>
        <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6" role="alert"><p><%= success_msg %></p></div>
    <% } %>

    <!-- Konten Utama: Detail dan Info Penting -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Kolom Kiri: Deskripsi -->
        <div class="lg:col-span-2 space-y-8">
            <div><h4 class="text-xl font-bold mb-2 border-b-2 border-primary-teal pb-2">Deskripsi Program</h4><p class="text-gray-700 whitespace-pre-wrap"><%= program.description %></p></div>
            <div><h4 class="text-xl font-bold mb-2 border-b-2 border-primary-teal pb-2">Persyaratan</h4><p class="text-gray-700 whitespace-pre-wrap"><%= program.persyaratan %></p></div>
            <div><h4 class="text-xl font-bold mb-2 border-b-2 border-primary-teal pb-2">Manfaat</h4><p class="text-gray-700 whitespace-pre-wrap"><%= program.manfaat %></p></div>
        </div>

        <!-- Kolom Kanan: Info Cepat dan Aksi -->
        <div class="space-y-4 p-5 bg-gray-50 rounded-lg border self-start">
            <h4 class="text-lg font-bold text-center mb-4">Informasi Penting</h4>
            <div><h5 class="text-sm font-bold">Periode Pendaftaran</h5><p class="text-sm"><%= new Date(program.pendaftaran_mulai).toLocaleDateString('id-ID', {day:'numeric',month:'long'}) %> - <%= new Date(program.pendaftaran_akhir).toLocaleDateString('id-ID', {day:'numeric',month:'long',year:'numeric'}) %></p></div>
            <div><h5 class="text-sm font-bold">Tanggal Pelaksanaan</h5><p class="text-sm"><%= new Date(program.tanggal_pelaksanaan).toLocaleDateString('id-ID', {weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'}) %></p></div>
            <div><h5 class="text-sm font-bold">Kontak Narahubung</h5><p class="text-sm"><%= program.kontak_narahubung %></p></div>
            
            <!-- Tombol Aksi -->
            <div class="pt-4 mt-4 border-t space-y-3">
                <form action="/programs/<%= program.id %>/apply" method="POST">
                    <button type="submit" class="primary-button w-full justify-center text-lg py-3" <%= hasApplied ? 'disabled' : '' %> style="opacity: <%= hasApplied ? 0.6 : 1 %>">
                         <% if (hasApplied) { %><i class="fas fa-check mr-2"></i> Anda Sudah Mendaftar<% } else { %><i class="fas fa-paper-plane mr-2"></i> Daftar Sekarang<% } %>
                    </button>
                </form>
                <!-- === TOMBOL BAGIKAN (BARU) === -->
                <button id="share-button" class="secondary-button w-full justify-center text-lg py-3 bg-gray-600 hover:bg-gray-700">
                    <i class="fas fa-share-alt mr-2"></i> Bagikan Program
                </button>
            </div>
        </div>
    </div>
</div>

<!-- === MODAL BAGIKAN (BARU) === -->
<div id="share-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-sm text-center">
        <div class="p-4 border-b">
            <h3 class="text-lg font-bold">Bagikan Program Ini</h3>
        </div>
        <div class="p-6">
            <p class="text-sm text-gray-600 mb-4">Bantu sebarluaskan kesempatan berharga ini ke teman-temanmu!</p>
            <div class="flex justify-center gap-4 text-4xl">
                <a id="share-whatsapp" href="#" target="_blank" class="text-green-500 hover:scale-110 transition-transform"><i class="fab fa-whatsapp-square"></i></a>
                <a id="share-twitter" href="#" target="_blank" class="text-sky-500 hover:scale-110 transition-transform"><i class="fab fa-twitter-square"></i></a>
                <a id="share-facebook" href="#" target="_blank" class="text-blue-600 hover:scale-110 transition-transform"><i class="fab fa-facebook-square"></i></a>
            </div>
            <div class="mt-6">
                <p class="text-xs text-gray-500 mb-1">Atau salin link:</p>
                <div class="relative">
                    <input type="text" id="share-link-input" class="form-input text-sm text-center bg-gray-100" readonly>
                    <button id="copy-link-btn" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-primary-teal p-1">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                <span id="copy-feedback" class="text-xs text-green-600 mt-1 hidden">Link disalin!</span>
            </div>
        </div>
        <div class="bg-gray-50 p-3 text-right rounded-b-xl">
             <button id="modal-close-btn" class="text-sm font-semibold text-gray-600 hover:text-gray-900 px-3 py-1">Tutup</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const shareButton = document.getElementById('share-button');
    const shareModal = document.getElementById('share-modal');
    const closeModalBtn = document.getElementById('modal-close-btn');

    if (shareButton) {
        shareButton.addEventListener('click', () => {
            const programUrl = window.location.href;
            const programTitle = document.getElementById('program-title-for-share').innerText;
            const shareText = `Yuk, ikut program volunteer "${programTitle}"! Lihat detailnya di sini:`;

            // Atur link untuk setiap tombol media sosial
            document.getElementById('share-whatsapp').href = `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + programUrl)}`;
            document.getElementById('share-twitter').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(programUrl)}&text=${encodeURIComponent(shareText)}`;
            document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(programUrl)}`;
            
            // Tampilkan URL di input field
            const shareLinkInput = document.getElementById('share-link-input');
            shareLinkInput.value = programUrl;

            shareModal.classList.remove('hidden');
        });
    }

    // Fungsi untuk menutup modal
    function closeModal() {
        shareModal.classList.add('hidden');
    }
    
    closeModalBtn.addEventListener('click', closeModal);
    shareModal.addEventListener('click', (e) => {
        if (e.target === shareModal) {
            closeModal();
        }
    });

    // Fungsi untuk menyalin link
    const copyLinkBtn = document.getElementById('copy-link-btn');
    copyLinkBtn.addEventListener('click', () => {
        const linkInput = document.getElementById('share-link-input');
        linkInput.select();
        document.execCommand('copy');

        // Berikan umpan balik visual
        const copyFeedback = document.getElementById('copy-feedback');
        copyFeedback.classList.remove('hidden');
        setTimeout(() => {
            copyFeedback.classList.add('hidden');
        }, 2000);
    });
});
</script>
